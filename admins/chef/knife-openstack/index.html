<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <meta content='width=device-width, initial-scale=1' name='viewport'>
    <link href="/assets/stylesheets/documentation.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/assets/javascripts/documentation.js" type="text/javascript"></script>
  </head>
  <body class='admins admins_chef admins_chef_knife-openstack admins_chef_knife-openstack_index'>
    <header class='notice'>
      <p>En cas de problème avec la documentation, veuillez <a href="https://github.com/ares-ensiie/documentation/issues/new">ouvrir une issue</a> ou nous contacter sur <a href="irc://irc.iiens.net/%23ares">#ares</a></p>
    </header>
    <article>
      <h1>L&#39;outil knife-openstack</h1>&#x000A;&#x000A;<h2>Présentation</h2>&#x000A;&#x000A;<p>knife-openstack est un plugin à l&#39;outil de manipulation de chef : knife. Ce plugin&#x000A;permet de demander à un cloud openstack de déployer de nouvelles machines virtuelles, &#x000A;d&#39;y bootstraper chef et d&#39;y appliquer des rôles et des recettes.</p>&#x000A;&#x000A;<h2>Déploiement de machines virtuelles</h2>&#x000A;<div class="highlight"><pre><span class="nx">knife</span> <span class="nx">openstack</span> <span class="nx">server</span> <span class="nb">create</span> <span class="o">--</span><span class="nb">image</span> <span class="o">&lt;</span><span class="nx">IMAGE_ID</span><span class="o">&gt;</span> <span class="na">-f</span> <span class="o">&lt;</span><span class="nx">FLAVOR_ID</span><span class="o">&gt;</span> <span class="na">-G</span> <span class="o">&lt;</span><span class="nx">GROUPS</span><span class="o">&gt;</span> <span class="na">-x</span> <span class="nx">ubuntu</span> <span class="na">-i</span> <span class="o">&lt;</span><span class="nx">PKEY</span><span class="o">&gt;</span> <span class="na">-N</span> <span class="o">&lt;</span><span class="nb">NAME</span><span class="o">&gt;</span> <span class="na">-E</span> <span class="o">&lt;</span><span class="nx">CHEF_ENV</span><span class="o">&gt;</span>&#x000A;</pre></div>&#x000A;<ul>&#x000A;<li><p>IMAGE_ID&#x000A;  knife openstack image list</p></li>&#x000A;<li><p>FLAVOR_ID&#x000A;  knife openstack flavor list</p></li>&#x000A;<li><p>GROUPS (X,Y,Z)&#x000A;Security groups du tenant actuel</p>&#x000A;&#x000A;<blockquote>&#x000A;<p>https://openstack.ares-ensiie.eu/nova/access_and_security/</p>&#x000A;</blockquote></li>&#x000A;<li><p>PKEY&#x000A;Clef SSH privée de la keychain utilisée, voir <a href="/admins/openstack/auth/user">Configuration Openstack</a></p></li>&#x000A;<li><p>NAME&#x000A;Nom donné à la VM, prière de le terminer en &ldquo;.ares&rdquo;, en tout cas pour les services du tenant &ldquo;production&rdquo;</p></li>&#x000A;<li><p>CHEF_ENV&#x000A;Environnement chef dans lequel va tourner la variable.</p>&#x000A;&#x000A;<ul>&#x000A;<li> production est utilisé pour les machines physiques ou tournent les différents services d&#39;openstack</li>&#x000A;<li> vm_prod  est utilisé pour les VMs en production.</li>&#x000A;</ul></li>&#x000A;</ul>&#x000A;&#x000A;<h2>Éteindre une instance</h2>&#x000A;<div class="highlight"><pre><span class="nx">knife</span> <span class="nx">openstack</span> <span class="nx">server</span> <span class="nb">delete</span> <span class="o">&lt;</span><span class="nx">INSTANCE_ID</span><span class="o">&gt;</span> <span class="na">-N</span> <span class="o">&lt;</span><span class="nb">NAME</span><span class="o">&gt;</span> <span class="na">-P</span>&#x000A;</pre></div>&#x000A;<ul>&#x000A;<li><p>INSTANCE_ID | NAME&#x000A;knife openstack server list</p></li>&#x000A;<li><p>-P : Purge, sert à supprimer le client et le noeud dans la base de données de Chef.</p></li>&#x000A;</ul>&#x000A;&#x000A;<h3>Note Importante /!\</h3>&#x000A;&#x000A;<p>Lorsque vous utilisez cette commande, l&#39;instance est simplement détruite, elle n&#39;est pas &ldquo;éteinte&rdquo; (graceful shutdown)&#x000A;Cela peut poser des problèmes lorsque des serveurs avec des fichiers sensibles sont en cours d&#39;utilisation. Pour pallier&#x000A;à ceci, veuiller <strong>éteindre la VM à la main</strong> avec un ssh sur la VM puis un &ldquo;halt&rdquo; ou &ldquo;poweroff&rdquo; ou encore &ldquo;shutdown -h now&rdquo;</p>
    </article>
  </body>
</html>
