<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <meta content='width=device-width, initial-scale=1' name='viewport'>
    <link href="/assets/stylesheets/documentation.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/assets/javascripts/documentation.js" type="text/javascript"></script>
  </head>
  <body class='admins admins_openstack admins_openstack_glance admins_openstack_glance_add-image admins_openstack_glance_add-image_index'>
    <header class='notice'>
      <p>En cas de problème avec la documentation, veuillez <a href="https://github.com/ares-ensiie/documentation/issues/new">ouvrir une issue</a> ou nous contacter sur <a href="irc://irc.iiens.net/%23ares">#ares</a></p>
    </header>
    <article>
      <h1>Ajouter une image à Openstack</h1>&#x000A;&#x000A;<h2>Intro</h2>&#x000A;&#x000A;<p>Le gestionnaire d&#39;images disque d&#39;Openstack s&#39;appelle Glance</p>&#x000A;&#x000A;<p><a href="http://docs.openstack.org/developer/glance/">http://docs.openstack.org/developer/glance/</a></p>&#x000A;&#x000A;<p>Sur notre infrastructure, Glance est installé sur <a href="/admins/servers/choucroute">choucroute</a>&#x000A;et les images y sont stockées également.</p>&#x000A;&#x000A;<h3>Prérequis</h3>&#x000A;&#x000A;<p>Toutes les images ajoutées à Glance doivent être compatible avec AWS EC2. C&#39;est-à-dire, qu&#39;à&#x000A;leur démarrage, elles aillent chercher les métadonnés auprès du service correspondant pour,&#x000A;par exemple, nous permettant d&#39;y accéder.</p>&#x000A;&#x000A;<h3>Le cas des images cloud Ubuntu</h3>&#x000A;&#x000A;<p>Canonical fournit des images &ldquo;cloud&rdquo; d&#39;Ubuntu, complètement compatible avec le mécanisme précédent :</p>&#x000A;&#x000A;<p><a href="http://cloud-images.ubuntu.com/">http://cloud-images.ubuntu.com/</a></p>&#x000A;&#x000A;<p>Elles sont disponibles dans plusieurs formats, je vais ici expliquer comment importer les images&#x000A;de type &ldquo;.img&rdquo;. (En fait .img n&#39;est pas un type, juste une extension pour dire que c&#39;est l&#39;image&#x000A;d&#39;un disque dur ou d&#39;une partition)</p>&#x000A;&#x000A;<h2>Ajouter une image</h2>&#x000A;&#x000A;<p>Il faut utiliser le client Glance, dont l&#39;outil en ligne de commande est simplement <code>glance</code>.&#x000A;Le mécanisme est le suivant:</p>&#x000A;&#x000A;<p><code>glance</code> <br>&#x000A;  → Requête d&#39;authentification à Keystone <br>&#x000A;  → Keystone renvoit le endpoint où il faut contacter Glance <br>&#x000A;  → Demande de l&#39;ajout de l&#39;image <em>donnée en entrée standard</em></p>&#x000A;&#x000A;<p>Pour l&#39;authentification c&#39;est comme tous les services d&#39;Openstack,&#x000A;le plus simple est de définir les variables d&#39;environnement suivantes :</p>&#x000A;&#x000A;<ul>&#x000A;<li><code>OS_USERNAME</code></li>&#x000A;<li><code>OS_PASSWORD</code></li>&#x000A;<li><code>OS_TENANT_NAME</code></li>&#x000A;<li><code>OS_AUTH_URL</code></li>&#x000A;</ul>&#x000A;&#x000A;<p>Il faut ensuite donné le format de l&#39;image. Pour les images Ubuntu, le format du container est&#x000A;<strong>ovf</strong> et celui du disk <strong>qcow2</strong>, aller voir <code>glance help add</code> pour plus de détails.</p>&#x000A;&#x000A;<h2>La commande</h2>&#x000A;&#x000A;<p>La manip au finale ressemble à ça</p>&#x000A;<div class="highlight"><pre>  <span class="n">export</span> <span class="n">OS_USERNAME</span><span class="o">=</span><span class="n">leo</span>&#x000A;  <span class="n">export</span> <span class="n">OS_PASSWORD</span><span class="o">=</span><span class="err">#</span><span class="n">SUPERPASSWORD</span><span class="err">#</span>&#x000A;  <span class="n">export</span> <span class="n">OS_TENANT_NAME</span><span class="o">=</span><span class="n">staging</span>&#x000A;  <span class="n">export</span> <span class="n">OS_AUTH_URL</span><span class="o">=</span><span class="n">http</span><span class="o">:</span><span class="c1">//ares-ensiie.eu:5000/v2.0/</span>&#x000A;  <span class="n">glance</span> <span class="n">add</span> <span class="o">-</span><span class="n">H</span> <span class="n">ares</span><span class="o">-</span><span class="n">ensiie</span><span class="p">.</span><span class="n">eu</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Ubuntu 13.04 64bits&quot;</span> <span class="n">is_public</span><span class="o">=</span><span class="n">True</span> <span class="n">container_format</span><span class="o">=</span><span class="n">ovf</span> <span class="n">disk_format</span><span class="o">=</span><span class="n">qcow2</span> <span class="o">&lt;</span> <span class="p">.</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">-</span><span class="mf">13.04</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">cloudimg</span><span class="o">-</span><span class="n">amd64</span><span class="o">-</span><span class="n">disk1</span><span class="p">.</span><span class="n">img</span>&#x000A;</pre></div>
    </article>
  </body>
</html>
